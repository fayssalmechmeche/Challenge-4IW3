{% extends 'base.html.twig' %}

{% block title %}Nouveau Devis
{% endblock %}


{% block body  %}
	{{ form_start(form, {'attr': {'id': 'devisForm'}}) }}
	<nav class="flex justify-between w-full items-center py-3 px-5 bg-nav-bar-black ">
		<a class="transition-all duration-300 text-white cursor-pointer hover:text-red-500 flex items-center gap-1" href="{{ path('app_devis_index') }}">
			<span class="material-symbols-outlined">
				arrow_circle_left</span>
			Retour à la liste</a>
		<button id="customSubmitButton" class="bg-white py-2 px-4 cursor-pointer rounded-md transition-all duration-300 text-base font-bold hover:bg-lime-500">Valider le Devis</button>
	</nav>
	<div class="Generator font-roboto w-A4w  bg-white my-5 mx-auto p-5 border border-solid border-gray-300 shadow-md">
		<div class="top h-auto w-full flex justify-between items-start">
			<div class="society w-1/2 flex justify-center items-start flex-col">
				<div class="logoName">
					<img class="w-36 h-36 border border-solid border-gray-300" src="{{ asset('images/society/'~ society.logo ?? 'placeholder.webp') }}alt="logo"/>
				</div>
				<div class="society-info mt-15px p-5px">
					<h2 class="text-lg mb-3 font-semibold">Le nom de la société</h2>
					<p class="text-15px">Nom :
						{{ userName }}</p>
					<p class="text-15px">Mail :
						{{ userEmail }}</p>
					<p class="text-15px">Téléphone :
						{{ userPhone }}</p>
					<p class="text-15px">Adresse :
						{{ userAddress }}</p>
				</div>
			</div>
			<div class="top-r w-1/2">
				<div class="devis w-full bg-the-grey-2 p-15px border border-solid border-gray-300 rounded-10px shadow-md flex justify-between items-start flex-col">
					<h1 class="text-2xl font-semibold">Devis</h1>
					<div class="devis-info">
						<p class="text-15px leading-none my-1">Numéro de devis:
							{{ form.devisNumber.vars.value }}</p>
						<p class="text-15px leading-none my-1">Date:
							{{ devi.createdAt|date("d/m/Y") }}</p>


						<p class="text-15px leading-none my-1">
							{{ form_label(form.dateValidite) }}
							{{ form_widget(form.dateValidite, {'attr': {'class': 'rounded-xl w-36 h-10 px-2 border border-solid border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:border-transparent shadow-form'}}) }}
						</p>
					</div>
				</div>
				<div class="client mt-3 px-5px">
					<h2 class="text-lg font-semibold">Information Client</h2>
					{{ form_label(form.customer) }}
					{{ form_widget(form.customer, {'attr': {'id': 'form_customer',
					'class':"rounded-xl w-full h-10 mt-1 px-2 bg-white border border-solid border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:border-transparent shadow-form"}}) }}
					<div class="client-info mt-2" style="display: none;" id="client-info">
						<div class="client-info mt-2">
							<p class="text-15px">Adresse</p>
							<p class="text-15px">Code Postal</p>
							<p class="text-15px">Ville</p>
							<p class="text-15px">Téléphone</p>
							<p class="text-15px">Mail</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="table-container w-full mt-7 flex justify-start items-center flex-col">
			<div class="objet w-full flex justify-start items-center mb-5 ml-5px">
				<h2 class="text-lg font-semibold">Objet:</h2>
				{{ form_widget(form.subject, {'attr': {'class': 'rounded-xl w-full h-10 ml-2 mt-1 px-2 py-2 border border-solid border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:border-transparent shadow-form',
				'placeholder': 'Votre texte ici'}}) }}
			</div>

			<div class="flex justify-start items-center w-full">
				<div class="flex flex-col w-72 px-1 my-1">
					<label class="font-semibold" for="productSelect">Choisir un produit:</label>
					<select class="rounded-xl w-full h-10 mt-1 px-2 bg-white border border-solid border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:border-transparent shadow-form" id="productSelect">
						{% for product in products %}
							<option value="{{ product.id }}" class="devisProducts" data-price="{{ product.price }}">{{ product.name }}</option>
						{% endfor %}
					</select>
					<div class="flex justify-start items-center mt-2">
						<input class="rounded-xl w-36 h-10 px-2 border border-solid border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:border-transparent shadow-form" type="number" id="productQuantity" placeholder="Quantité" min="0">
						<button class="text-white font-medium bg-button-blue hover:bg-button-blue-hover transition-all duration-300 ease-out rounded-lg m-1 px-3 py-2 flex items-center gap-2 ml-auto" id="addProductButton" type="button">Ajouter<span class="material-symbols-outlined">
								add_circle
							</span>
						</button>
					</div>
				</div>
				<div class="flex flex-col w-72 px-1 my-1 ml-auto">
					<label class="font-semibold" for="formulaSelect">Choisir un formule:</label>
					<select class="rounded-xl w-full h-10 mt-1 px-2 bg-white border border-solid border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:border-transparent shadow-form" id="formulaSelect">
						{% for formula in formulas %}
							<option value="{{ formula.id }}" class="devisFormulas" data-price="{{ formula.price }}">{{ formula.name }}</option>
						{% endfor %}
					</select>
					<div class="flex justify-start items-center mt-2">
						<input class="rounded-xl w-36 h-10 px-2 border border-solid border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:border-transparent shadow-form" type="number" id="formulaQuantity" placeholder="Quantité" min="0">
						<button class="text-white font-medium bg-button-blue hover:bg-button-blue-hover transition-all duration-300 ease-out rounded-lg m-1 px-3 py-2 flex items-center gap-2 ml-auto" id="addFormulaButton" type="button">Ajouter<span class="material-symbols-outlined">
								add_circle
							</span>
						</button>
					</div>
				</div>

			</div>

			<div id="wrapper"></div>
			<div class="mid w-full h-auto flex justify-between items-start">
				<div class="condition mt-12 flex justify-start items-start flex-col w-70%">
				{% if form.depositPercentage.vars.value is not empty %}

						<h2 class="text-lg font-semibold">Conditions de paiement:</h2>
						<p class="mt-5 text-lg">
							Paiement d'un acompte de  {{ form_widget(form.depositPercentage, {'attr': {'class': 'form-control w-9', 'id': 'devis_depositPercentage'}}) }}
							{{ form_errors(form.depositPercentage) }}% du prix total TTC.
						</p>

				{% endif %}
				</div>


				<div class="total w-37% flex justify-start items-end mt-12 mr-5px flex-col">
					<div class="total-sub-container flex justify-start items-center m-0">
						{{ form_label(form.totalPrice, 'Total HT:', {'label_attr': {'class': 'text-base font-semibold'}}) }}
						<div class="total-tab ml-5px p-4 w-40 bg-the-grey-2">
							<p class="text-lg text-right">
								{{ form_widget(form.totalPrice, {'attr': {'class': 'custom-class-for-total-price bg-the-grey-2 w-1/2'}}) }} €
							</p>
						</div>
					</div>
					<div class="total-sub-container flex justify-start items-center m-0">
						<h3 class="text-base font-semibold">{{ form_label(form.taxe) }}</h3>
						<div class="total-tab ml-5px p-4 w-40 bg-the-grey-2">
							<p class="text-lg text-right">{{ form_widget(form.taxe, {'attr': {'class': 'bg-the-grey-2 w-1/2'}}) }} %</p>
						</div>
					</div>
					<div class="total-sub-container flex justify-start items-center m-0">
						<div class="total-sub-container flex justify-start items-center m-0">
							{{ form_label(form.totalDuePrice, 'Total TTC:', {'label_attr': {'class': 'text-base font-semibold'}}) }}
							<div class="total-tab alt ml-5px p-4 w-40 bg-light-dark">
								<p class="text-lg text-right text-white">
									{{ form_widget(form.totalDuePrice, {'attr': {'class': 'bg-light-dark w-1/2'}}) }} €
								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="signature mt-12 mr-5px ml-auto pt-3 pl-3 w-52 h-28 border border-solid border-gray-300 bg-the-grey-2">
			<p>Signature:</p>
		</div>
		<div class="bottom w-full flex justify-start items-start flex-col">
			<div class="divider w-full h-2px rounded-2xl bg-the-grey-2 my-5"></div>
			<div class="bottom-info w-full flex justify-center items-center">
				<p class="text-sm my-2 text-the-grey">SARL Fourchette</p>
				<p class="text-sm my-2 text-the-grey">Capital de 1000 €</p>
				<p class="text-sm my-2 text-the-grey">RCS:12345</p>
				<p class="text-sm my-2 text-the-grey">Code APE: AZERTY12345</p>
				<p class="text-sm my-2 text-the-grey">N° TVA: FR3353215643668909</p>
			</div>
		</div>
	</div>
	<div id="hiddenFieldsContainer"></div>
	{{ form_end(form) }}

  {% include 'components/dark_mode.html.twig' with {'topHeight': 'top-20'} %}

{% endblock %}
{% block javascripts %}
	{{ parent() }}
	<script type="module">
		import {init} from '{{ asset('js/devisUpdate.js') }}';
init({{ devisItems|json_encode|raw }}, {{ clientId }});
	</script>
{% endblock %}
