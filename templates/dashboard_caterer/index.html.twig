{% extends 'base_caterer.html.twig' %}
{% block title %}
	Dahsboard ^^
{% endblock %}

{% block content %}


	<div class="flex flex-col mx-auto h-fit w-95% rounded-2xl bg-white dark:bg-dark-section p-3 gap-10">
		<h1 class="px-5 text-5xl mt-2 mb-10 dark:text-white">Mon dashboard</h1>

		<!-- first block -->
		<div class="flex gap-10 justify-evenly flex-wrap">
			<!-- sold block -->
			<div class="relative flex flex-grow p-10 flex-1 max-sm:p-0 max-sm:pb-5 min-w-[370px] max-sm:min-w-[240px] max-sm:flex-col-reverse w-[535px] max-w-[535px] h-[290px] justify-between items-center bg-white dark:bg-dark-card rounded-3xl shadow-xl border-t dark:border-none">
				<div class="flex flex-col items-start gap-3 z-[1] max-sm:pt-2">
					<h2 class="text-3xl font-bold dark:text-white">Solde total</h2>
					<span id="last-deal" class="text-2xl text-[#4FD18B] font-bold">
						{{ lastInvoicePaid ? '+' ~ lastInvoicePaid|number_format(2, ',', '.') ~ '€' : 'Aucune' }}
					</span>
					<p class="text-grey-p text-base dark:text-white">Dernière transaction</p>
					<div class="flex justify-start items-center">
						<button class="px-8 py-3 bg-progress-bar-1 text-white text-sm font-bold rounded-btn-rounded tracking-wider uppercase hover:bg-white hover:text-progress-bar-1 hover:border-progress-bar-1 border border-solid border-progress-bar-1 transition-all duration-300 ease-in-out">
							Historique
						</button>
						{# <button class="px-8 py-3 ml-1 border border-solid border-progress-bar-1 text-progress-bar-1 text-sm font-bold rounded-btn-rounded tracking-wider uppercase hover:bg-progress-bar-1 hover:text-white transition-all duration-300 ease-in-out">
							Retrait
						</button> #}
					</div>
				</div>
				{# <div> #}
				<div class="flex flex-col items-center z-[1] max-sm:h-1/3 max-sm:w-full max-sm:rounded-tl-3xl max-sm:rounded-tr-3xl max-sm:bg-progress-bar-1 max-sm:p-3">
					<h2 class="text-4xl font-bold text-white">{{totalBalance.totalReceived|number_format(2, ',', '.')}}€</h2>
					<p class="text-grey-p text-base tracking-widest">Votre portefeuille</p>
				</div>
				<!-- background -->
				<div class="bg-progress-bar-1 op h-full w-56 rounded-s-155px rounded-e-3xl absolute top-0 right-0 max-sm:hidden"></div>
				{# </div> #}
			</div>
			<!-- Chart Block -->
			<div class="flex flex-col flex-grow px-10 max-sm:p-5 py-5 justify-center flex-1 min-w-[240px] w-[535px] max-w-[535px] h-[290px] bg-white dark:bg-dark-card rounded-3xl shadow-xl border-t dark:border-none">
				<p class="text-grey-p text-center text-base dark:text-white">Montant devis par mois (en €) :</p>
				<canvas id="chartCA">
					<p>Chart CA</p>
				</canvas>
			</div>
		</div>

		<!-- Section Card -->
		<div class="flex gap-10 justify-evenly flex-wrap">
			<div class="flex gap-10 justify-evenly flex-wrap flex-grow">
				<!-- card-info -->
				{% include 'components/card-info.twig' with {
					description: 'Prévision pour ce mois :',
					amount:'+ ' ~ amountDevisMonth ~ ' €',
					percentage: differenceLastAndCurrentMonthDevis|number_format(0)
				
				} %}
				<!-- card-info -->
				{% include 'components/card-info.twig' with {
					description: 'Nouveaux acquis :',
					amount: '+ ' ~ NbNewCustomersMonth ~ ' clients',
					percentage: differenceLastAndCurrentMonthCustomers
				
				} %}
			</div>
			<div class="flex gap-10 justify-evenly flex-wrap flex-grow">
				<!-- card-info -->
				{% include 'components/card-info.twig' with {
					description: 'En attente :',
					amount: nbDevisPending.totalPending  ~ ' devis',
					redirectUrl: 'app_devis_index'
				} %}
				<!-- card-info -->
				{% include 'components/card-info.twig' with {
					description: 'En attente :',
					amount: nbInvoicePending.totalPending ~ ' factures',
					redirectUrl: 'app_invoice_index'
				} %}
			</div>
		</div>

		<!-- Conteneur pour les tableaux Grid.js -->
		<div class="flex flex-wrap gap-10">
			<div class="flex-grow w-[370px] max-md:w-full">
				<h1 class='text-4xl font-bold mb-3 dark:text-white'>Liste des Clients</h1>
				<!-- Conteneur pour le tableau Grid.js client -->
				<div class="max-h-96 flex justify-between items-start overflow-scroll" id="customer-table"></div>
			</div>
			<div class="flex-grow w-[370px] max-md:w-full">
				<h1 class='text-4xl font-bold mb-3 dark:text-white'>Liste des Produits</h1>
				<!-- Conteneur pour le tableau Grid.js produit -->
				<div class="max-h-96 flex justify-between items-start overflow-scroll" id="product-table"></div>
			</div>
		</div>
	</div>

	<!-- Modal pour la création d'un nouveau client -->
	{% set dynamicContent %}
	<div>
		<p>Contenu construit directement dans Twig.</p>
	</div>
	{% endset %}

	{% include 'components/modal.html.twig' with {
        'modal_id': 'newModalId',
        'modal_content_id': 'newModalModalContentId',
        'content': dynamicContent
    } %}

	<!-- Modal pour la modification d'un client -->
	{% include 'components/modal.html.twig' with {
        'modal_id': 'customerEditModal',
        'modal_content_id': 'customerEditModalContent',
        'content': dynamicContent
    } %}

	<!-- Modal pour les détails du client -->
	{% include 'components/modal.html.twig' with {
        'modal_id': 'customerDetailsModal',
        'modal_content_id': 'customerDetailsModalContainer',
        'content': dynamicContent
    } %}


	<!-- Modal pour la création d'un nouveau produit -->
	{% set dynamicContent %}
	<div>
		<p>Contenu construit directement dans Twig.</p>
	</div>
	{% endset %}

	{% include 'components/modal.html.twig' with {
        'modal_id': 'newProductModalId',
        'modal_content_id': 'newProductModalContentId',
        'content': dynamicContent
    } %}

    <!-- Modal pour la modification d'un produit -->
	{% include 'components/modal.html.twig' with {
        'modal_id': 'productEditModal',
        'modal_content_id': 'productEditModalContent',
        'content': dynamicContent
    } %}

    <!-- Modal pour les détails d'un produit -->
	{% include 'components/modal.html.twig' with {
        'modal_id': 'produitDetailsModal',
        'modal_content_id': 'produitDetailsModalContentId',
        'content': dynamicContent
    } %}
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script>
		var csrfToken = '{{ csrf_token('delete_customer') }}';
	</script>
	<script src="{{ asset('js/dashboardGrid.js') }}"></script>
	<script src="{{ asset('js/dashboard.js') }}"></script>
	<script>
		let labelChartCA = [{% for month, totalPrice in totalPriceByMonth %}'{{ month }}',{% endfor %}];
let dataChartCA = [{% for totalPrice in totalPriceByMonth %}{{ totalPrice }},{% endfor %}];
	</script>
	<script src="{{ asset('js/accountant.js') }}"></script>
	<script src="{{ asset('js/customer.js') }}"></script>
	<script src="{{ asset('js/customerGrid.js') }}"></script>
	<script src="{{ asset('js/productGrid.js') }}"></script>
	<script src="{{ asset('js/product.js') }}"></script>
{% endblock %}
