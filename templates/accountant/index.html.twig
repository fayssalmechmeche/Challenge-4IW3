{% extends 'base_caterer.html.twig' %}

{% block title %}Hello AccountantController!
{% endblock %}

{% block content %}
	<h1 class="px-5 text-5xl mt-2 mb-10">Rapports financiers</h1>

	<!-- first block -->
	<div
		class="px-5 mb-10 lg:w-ds-block mx-auto lg:h-72 flex lg:justify-between lg:items-center lg:flex-row flex-col justify-start items-start gap-10 lg:gap-0">
		<!-- sold block -->
		<div class="relative px-10 w-[535px] h-72 flex flex-col justify-center items-center bg-white rounded-3xl shadow-xl">
			<p class="text-grey-p text-base">Rapports devis :</p>
			<div class="flex gap-1">
				<button onclick="generateDevisXLSX();" class="text-white w-48 font-medium bg-green-600 hover:bg-green-500 transition-all duration-300 ease-out rounded-lg my-3 px-3 py-2">
					Excel des devis
				</button>
				<button onclick="generateDevisPDF();" class="text-white w-48 font-medium bg-red-600 hover:bg-red-500 transition-all duration-300 ease-out rounded-lg my-3 px-3 py-2">
					Pdf des devis
				</button>
			</div>
			<p class="text-grey-p text-base">Rapports produits commandés :</p>
			<div class="flex gap-1">
				<button onclick="generateDevisProductXLSX();" class="text-white w-48 font-medium bg-green-600 hover:bg-green-500 transition-all duration-300 ease-out rounded-lg my-3 px-3 py-2">
					Excel des produits
				</button>
				<button onclick="generateDevisProductPDF();" class="text-white w-48 font-medium bg-red-600 hover:bg-red-500 transition-all duration-300 ease-out rounded-lg my-3 px-3 py-2">
					Pdf des produits
				</button>
			</div>
			<p class="text-grey-p text-base">Rapports formules commandées :</p>
			<div class="flex gap-1">
				<button onclick="generateDevisFormulaXLSX();" class="text-white w-48 font-medium bg-green-600 hover:bg-green-500 transition-all duration-300 ease-out rounded-lg my-3 px-3 py-2">
					Excel des formulaires
				</button>
				<button onclick="generateDevisFormulaPDF();" class="text-white w-48 font-medium bg-red-600 hover:bg-red-500 transition-all duration-300 ease-out rounded-lg my-3 px-3 py-2">
					Pdf des formulaires
				</button>
			</div>
		</div>
		<!-- Chart Block -->
		<div class="lg:ml-10 relative px-10 w-[535px] h-72 flex flex-col justify-center items-center bg-white rounded-3xl shadow-xl">
			<p class="text-grey-p text-base">Montant ventes effectuées par mois (en €) :</p>
			<canvas id="chartCA">
				<p>Chart CA</p>
			</canvas>
		</div>
	</div>
	<!-- End first block -->

	<!-- second block -->
	<div
		class="px-5 mb-10 lg:w-ds-block mx-auto lg:h-72 flex lg:justify-between lg:items-center lg:flex-row flex-col justify-start items-start gap-10 lg:gap-0">
		<!-- sold block -->
		<div class="relative flex flex-col px-5 pb-10 w-[535px] h-72 items-center bg-white rounded-3xl shadow-xl">
			<p class="text-grey-p text-base">Total commandes par produits :</p>
			<canvas id="chartProducts">
				<p>Chart Products</p>
			</canvas>
		</div>
		<!-- Chart Block -->
		<div class="relative flex flex-col px-5 pb-10 w-[535px] h-72 items-center bg-white rounded-3xl shadow-xl">
			<p class="text-grey-p text-base">Total commandes par clients :</p>
			<canvas id="chartCustomers">
				<p>Chart Clients</p>
			</canvas>
		</div>
	</div>
	<!-- End second block -->

	<!-- Third block Ranked -->
	<div
		class="px-5 lg:w-ds-block mx-auto lg:h-fit flex lg:justify-between lg:items-center mb-10 lg:flex-row flex-col justify-start items-start gap-10 lg:gap-0">
		<!-- card-info Most Product-->
		<div class="px-7 py-3 bg-white w-60 rounded-xl shadow-xl flex flex-col justify-start items-start gap-2">
			<p class="text-grey-p text-base">Produit le plus vendu</p>
			<h2 class="text-3xl font-bold">{{nameMostSellProduct.name is defined ? nameMostSellProduct.name : 'Aucun'}}</h2>
			<p class="text-grey-p text-base">Quantité:
				{{nameMostSellProduct.totalQuantity is defined ? nameMostSellProduct.totalQuantity : 'Aucun'}}</p>
			<div class="flex justify-center items-center bg-bg-light-green w-24 rounded-3xl px-5 py-2">
				<span class="material-symbols-outlined text-light-green">
					trending_up
				</span>
				<p class="text-light-green font-bold">+</p>
				<p class="text-light-green font-bold">11%</p>
			</div>
		</div>
		<!-- card-info Less Product -->
		<div class="px-7 py-3 bg-white w-60 rounded-xl shadow-xl flex flex-col justify-start items-start gap-2">
			<p class="text-grey-p text-base">Produit le moins vendu</p>
			<h2 class="text-3xl font-bold">{{nameLessSellProduct.name is defined ? nameLessSellProduct.name : 'Aucun'}}</h2>
			<p class="text-grey-p text-base">Quantité:
				{{nameLessSellProduct.totalQuantity is defined ? nameLessSellProduct.totalQuantity : 'Aucun' }}</p>
			<div class="flex justify-center items-center bg-bg-light-red w-24 rounded-3xl px-5 py-2">
				<span class="material-symbols-outlined text-light-red">
					trending_down
				</span>
				<p class="text-light-red font-bold">-</p>
				<p class="text-light-red font-bold">8%</p>
			</div>
		</div>
		<!-- card-info Highest Customer -->
		<div class="px-7 py-3 bg-white w-60 rounded-xl shadow-xl flex flex-col justify-start items-start gap-2">
			<p class="text-grey-p text-base">Client le plus fidèle</p>
			<h2 class="text-3xl font-bold">{{customerWithHighestSpending.name is defined ? customerWithHighestSpending.name : 'Aucun'}}</h2>
			<p class="text-grey-p text-base">Commandes:
				{{customerWithHighestSpending.totalOrders is defined ? customerWithHighestSpending.totalOrders : 'Aucun'}}</p>
			{# <p class="text-grey-p text-base">Dépensé:
																																																																																																																																																																{{customerWithHighestSpending.totalSpending}}</p> #}
			<div class="flex justify-center items-center bg-bg-light-green w-24 rounded-3xl px-5 py-2">
				<span class="material-symbols-outlined text-light-green">
					trending_up
				</span>
				<p class="text-light-green font-bold">+</p>
				<p class="text-light-green font-bold">15%</p>
			</div>
		</div>
		<!-- card-info Lowest Customer-->
		<div class="px-7 py-3 bg-white w-60 rounded-xl shadow-xl flex flex-col justify-start items-start gap-2">
			<p class="text-grey-p text-base">Client le moins fidèle</p>
			<h2 class="text-3xl font-bold">{{customerWithLowestSpending.name is defined ? customerWithLowestSpending.name : 'Aucun'}}</h2>
			<p class="text-grey-p text-base">Commandes:
				{{customerWithLowestSpending.totalOrders is defined ? customerWithLowestSpending.totalOrders : 'Aucun'}}</p>
			{# <p class="text-grey-p text-base">Dépensé:
																																																																																																																																																																{{customerWithLowestSpending.totalSpending}}</p> #}
			<div class="flex justify-center items-center bg-bg-light-red w-24 rounded-3xl px-5 py-2">
				<span class="material-symbols-outlined text-light-red">
					trending_down
				</span>
				<p class="text-light-red font-bold">-</p>
				<p class="text-light-red font-bold">8%</p>
			</div>
		</div>
	</div>
	<!-- End Third block -->

	{% block javascripts %}
		{{ parent() }}
		<script>
			let labelChartCA = [{% for month, totalPrice in totalPriceByMonth %}'{{ month }}',{% endfor %}];
let dataChartCA = [{% for totalPrice in totalPriceByMonth %}{{ totalPrice }},{% endfor %}];
let labelChartProducts = [{% for product in products %}'{{ product.name }}',{% endfor %}];
let dataChartProducts = [{% for product in products %}{{ product.totalquantity ?: 0 }},{% endfor %}];
let labelChartCustomers = [{% for customer in customers %}'{{ customer.name }}',{% endfor %}];
let dataChartCustomers = [{% for customer in customers %}{{ customer.totalOrders ?: 0 }},{% endfor %}];
		</script>
		<script src="{{ asset('js/accountant.js') }}"></script>
		<script src="{{ asset('js/excel.js') }}"></script>
	{% endblock %}
{% endblock %}
